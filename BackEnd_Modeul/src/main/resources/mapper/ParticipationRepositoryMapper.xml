<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.modeul.web.repository.ParticipationRepository">

  <resultMap id="ParticipationResultMap" type="Participation">
    <result property="memberId" column="member_id" />
    <result property="stuffId" column="stuff_id" />
  </resultMap>

  <resultMap id="ParticipationViewResultMap" type="ParticipationView">
    <result property="memberId" column="member_id" />
    <result property="stuffId" column="stuff_id" />
    <result property="stuffTitle" column="stuff_title" />
    <result property="stuffPlace" column="stuff_place" />
    <result property="stuffNumPeople" column="stuff_num_people" />
    <result property="stuffDeadline" column="stuff_deadline" />
    <result property="stuffPrice" column="stuff_price" />
    <result property="stuffMemberId" column="stuff_member_id" />
    <result property="categoryId" column="category_id" />
    <result property="categoryName" column="category_name" />
    <result property="imageName" column="image_name" />
  </resultMap>

  <resultMap id="ParticipationMemberViewResultMap" type="ParticipationMemberView">
    <result property="stuffId" column="stuff_id" />
    <result property="memberId" column="member_id" />
    <result property="memberNickname" column="member_nickname" />
    <result property="memberImage" column="member_image" />
  </resultMap>
 
	<insert id="insert" parameterType="Participation">
		insert into participation(member_id, stuff_id)
		values(#{memberId}, #{stuffId})
	</insert>

  <!-- order by들 다시 생각 -->
  <select id="findByMemberId" resultMap="ParticipationViewResultMap">
    select * 
    from participation_view
    where member_id = #{memberId}
    <if test="categoryId != null">
				and category_id = #{categoryId}
    </if>
    <if test="orderField != null and orderDir != null">
			order by ${orderField} ${orderDir}
		</if>
    <if test="size != null and offset != null">
			limit ${size} offset ${offset}
		</if>
  </select>

  <select id="findMemberBystuffId" resultMap="ParticipationMemberViewResultMap">
    select * 
    from participation_member_view
    where stuff_id = #{stuffId}
  </select>

</mapper>